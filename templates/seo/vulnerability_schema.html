<!-- Vulnerability Schema Markup Template -->
<!-- Este template gera schema markup estruturado para páginas de vulnerabilidades -->

{% if vulnerability %}
<!-- Structured Data - SecurityVulnerability Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SecurityVulnerability",
  "name": "{{ vulnerability.cve_id or vulnerability.title or 'Vulnerabilidade de Segurança' }}",
  "identifier": "{{ vulnerability.cve_id or vulnerability.id }}",
  "description": "{{ vulnerability.description | truncate(500) | replace('"', '\"') if vulnerability.description else 'Vulnerabilidade de segurança identificada no sistema' }}",
  "url": "{{ url_for('vulnerability_ui.vulnerability_details_ui', id=vulnerability.id, _external=True) }}",
  "datePublished": "{{ vulnerability.published_date.isoformat() if vulnerability.published_date else vulnerability.created_at.isoformat() }}",
  "dateModified": "{{ vulnerability.last_modified_date.isoformat() if vulnerability.last_modified_date else vulnerability.updated_at.isoformat() }}",
  {% if vulnerability.severity %}
  "severity": "{{ vulnerability.severity }}",
  {% endif %}
  {% if vulnerability.cvss_score %}
  "cvssScore": {{ vulnerability.cvss_score }},
  {% endif %}
  {% if vulnerability.cvss_vector %}
  "cvssVector": "{{ vulnerability.cvss_vector }}",
  {% endif %}
  "publisher": {
    "@type": "Organization",
    "name": "{{ config.get('SITE_NAME', 'Open Monitor') }}",
    "url": "{{ url_for('main.index', _external=True) }}"
  },
  {% if vulnerability.affected_products %}
  "affectedSoftware": [
    {% for product in vulnerability.affected_products[:5] %}
    {
      "@type": "SoftwareApplication",
      "name": "{{ product.product_name | replace('"', '\"') }}",
      {% if product.vendor %}
      "publisher": {
        "@type": "Organization",
        "name": "{{ product.vendor | replace('"', '\"') }}"
      },
      {% endif %}
      {% if product.version_start or product.version_end %}
      "softwareVersion": "{{ product.version_start or '' }}{% if product.version_end %} - {{ product.version_end }}{% endif %}"
      {% endif %}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ],
  {% endif %}
  {% if vulnerability.references %}
  "citation": [
    {% for reference in vulnerability.references[:10] %}
    {
      "@type": "CreativeWork",
      "url": "{{ reference.url }}",
      {% if reference.source %}
      "publisher": {
        "@type": "Organization",
        "name": "{{ reference.source | replace('"', '\"') }}"
      },
      {% endif %}
      "name": "{{ reference.name or reference.source or 'Referência de Segurança' | replace('"', '\"') }}"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ],
  {% endif %}
  "mainEntity": {
    "@type": "TechArticle",
    "headline": "{{ vulnerability.cve_id or vulnerability.title | replace('"', '\"') }}",
    "description": "{{ vulnerability.description | truncate(300) | replace('"', '\"') if vulnerability.description else 'Análise detalhada da vulnerabilidade de segurança' }}",
    "author": {
      "@type": "Organization",
      "name": "{{ config.get('SITE_NAME', 'Open Monitor') }} Security Team"
    },
    "datePublished": "{{ vulnerability.published_date.isoformat() if vulnerability.published_date else vulnerability.created_at.isoformat() }}",
    "dateModified": "{{ vulnerability.last_modified_date.isoformat() if vulnerability.last_modified_date else vulnerability.updated_at.isoformat() }}",
    "publisher": {
      "@type": "Organization",
      "name": "{{ config.get('SITE_NAME', 'Open Monitor') }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ url_for('static', filename='img/logo.png', _external=True) }}"
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ url_for('vulnerability_ui.vulnerability_details_ui', id=vulnerability.id, _external=True) }}"
    }
  }
}
</script>

<!-- Breadcrumb Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ url_for('main.index', _external=True) }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Vulnerabilidades",
      "item": "{{ url_for('vulnerability_ui.list_vulnerabilities_ui', _external=True) }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ vulnerability.cve_id or vulnerability.title or 'Detalhes da Vulnerabilidade' }}",
      "item": "{{ url_for('vulnerability_ui.vulnerability_details_ui', id=vulnerability.id, _external=True) }}"
    }
  ]
}
</script>

<!-- FAQ Schema (se houver seção de FAQ) -->
{% if vulnerability.faqs or vulnerability.common_questions %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "O que é {{ vulnerability.cve_id or 'esta vulnerabilidade' }}?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{{ vulnerability.description | truncate(300) | replace('"', '\"') if vulnerability.description else 'Uma vulnerabilidade de segurança que requer atenção.' }}"
      }
    },
    {% if vulnerability.severity %}
    {
      "@type": "Question",
      "name": "Qual é a severidade desta vulnerabilidade?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Esta vulnerabilidade tem severidade {{ vulnerability.severity }}{% if vulnerability.cvss_score %} com pontuação CVSS de {{ vulnerability.cvss_score }}{% endif %}."
      }
    },
    {% endif %}
    {
      "@type": "Question",
      "name": "Como posso me proteger desta vulnerabilidade?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Recomenda-se aplicar as correções de segurança disponíveis, manter sistemas atualizados e seguir as melhores práticas de segurança. Consulte as referências oficiais para mais detalhes."
      }
    }
  ]
}
</script>
{% endif %}

{% endif %}

<!-- Generic Security Article Schema for vulnerability lists -->
{% if vulnerabilities and not vulnerability %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Lista de Vulnerabilidades de Segurança",
  "description": "Catálogo abrangente de vulnerabilidades de segurança identificadas e analisadas",
  "url": "{{ request.url }}",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ vulnerabilities|length if vulnerabilities else 0 }},
    "itemListElement": [
      {% for vuln in vulnerabilities[:10] %}
      {
        "@type": "ListItem",
        "position": {{ loop.index }},
        "item": {
          "@type": "SecurityVulnerability",
          "name": "{{ vuln.cve_id or vuln.title or 'Vulnerabilidade' }}",
          "url": "{{ url_for('vulnerability_ui.vulnerability_details_ui', id=vuln.id, _external=True) }}",
          {% if vuln.severity %}
          "severity": "{{ vuln.severity }}",
          {% endif %}
          "datePublished": "{{ vuln.published_date.isoformat() if vuln.published_date else vuln.created_at.isoformat() }}"
        }
      }{% if not loop.last %},{% endif %}
      {% endfor %}
    ]
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ config.get('SITE_NAME', 'Open Monitor') }}",
    "url": "{{ url_for('main.index', _external=True) }}"
  }
}
</script>
{% endif %}