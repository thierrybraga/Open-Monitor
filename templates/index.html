{% extends "base.html" %}

{% block title %}Dashboard - Open Monitor{% endblock %}

{% block meta_description %}Dashboard de segurança em tempo real. Monitore vulnerabilidades críticas, métricas de segurança e status do sistema de forma centralizada e intuitiva.{% endblock %}

{% block meta_keywords %}dashboard, segurança, monitoramento, vulnerabilidades, métricas, tempo real, sistema de segurança, análise{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header do Dashboard -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">Dashboard de Segurança</h1>
        <p class="dashboard-subtitle">Visão geral das vulnerabilidades e status do sistema</p>
    </div>
    
    <!-- Cards de Métricas -->
    <div class="metric-cards">
        <div class="metric-card critical">
            <div class="metric-card-header">
                <h3 class="metric-card-title">Vulnerabilidades Críticas</h3>
                <div class="metric-card-icon">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                </div>
            </div>
            <div class="metric-card-value">{{ critical_count | default(0) }}</div>
            <p class="metric-card-description">Requerem atenção imediata</p>
            <div class="metric-card-weekly">
                <span class="weekly-badge critical">
                    <i class="bi bi-calendar-week"></i>
                    +{{ weekly_critical | default(0) }} esta semana
                </span>
            </div>
            <div class="metric-card-footer">
                <a href="{{ url_for('vulnerability_ui.list_vulnerabilities_ui') }}?severity=CRITICAL" class="metric-card-link">
                    Ver detalhes <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="metric-card high">
            <div class="metric-card-header">
                <h3 class="metric-card-title">Vulnerabilidades Altas</h3>
                <div class="metric-card-icon">
                    <i class="bi bi-exclamation-circle-fill"></i>
                </div>
            </div>
            <div class="metric-card-value">{{ high_count | default(0) }}</div>
            <p class="metric-card-description">Prioridade alta para correção</p>
            <div class="metric-card-weekly">
                <span class="weekly-badge high">
                    <i class="bi bi-calendar-week"></i>
                    +{{ weekly_high | default(0) }} esta semana
                </span>
            </div>
            <div class="metric-card-footer">
                <a href="{{ url_for('vulnerability_ui.list_vulnerabilities_ui') }}?severity=HIGH" class="metric-card-link">
                    Ver detalhes <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="metric-card medium">
            <div class="metric-card-header">
                <h3 class="metric-card-title">Vulnerabilidades Médias</h3>
                <div class="metric-card-icon">
                    <i class="bi bi-info-circle-fill"></i>
                </div>
            </div>
            <div class="metric-card-value">{{ medium_count | default(0) }}</div>
            <p class="metric-card-description">Monitoramento contínuo</p>
            <div class="metric-card-weekly">
                <span class="weekly-badge medium">
                    <i class="bi bi-calendar-week"></i>
                    +{{ weekly_medium | default(0) }} esta semana
                </span>
            </div>
            <div class="metric-card-footer">
                <a href="{{ url_for('vulnerability_ui.list_vulnerabilities_ui') }}?severity=MEDIUM" class="metric-card-link">
                    Ver detalhes <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
        
        <div class="metric-card total">
            <div class="metric-card-header">
                <h3 class="metric-card-title">Total de Vulnerabilidades</h3>
                <div class="metric-card-icon">
                    <i class="bi bi-shield-exclamation"></i>
                </div>
            </div>
            <div class="metric-card-value">{{ total_count | default(0) }}</div>
            <p class="metric-card-description">Todas as vulnerabilidades</p>
            <div class="metric-card-weekly">
                <span class="weekly-badge total">
                    <i class="bi bi-calendar-week"></i>
                    +{{ weekly_total | default(0) }} esta semana
                </span>
            </div>
            <div class="metric-card-footer">
                <a href="{{ url_for('vulnerability_ui.list_vulnerabilities_ui') }}" class="metric-card-link">
                    Ver todas <i class="bi bi-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
            
    <!-- Ações Rápidas -->
    <div class="quick-actions-section">
        <div class="section-header">
            <h2 class="section-title">Ações Rápidas</h2>
            <p class="section-subtitle">Acesso direto às principais funcionalidades</p>
        </div>
        
        <div class="quick-actions-grid">
            <a href="{{ url_for('main.search') }}" class="quick-action-card">
                <div class="quick-action-icon search">
                    <i class="bi bi-search"></i>
                </div>
                <div class="quick-action-content">
                    <h3 class="quick-action-title">Buscar Vulnerabilidades</h3>
                    <p class="quick-action-description">Pesquise por CVEs específicos ou filtros avançados</p>
                </div>
                <div class="quick-action-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('report.list_reports') }}" class="quick-action-card">
                <div class="quick-action-icon reports">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <div class="quick-action-content">
                    <h3 class="quick-action-title">Relatórios</h3>
                    <p class="quick-action-description">Gere e visualize relatórios de segurança</p>
                </div>
                <div class="quick-action-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('asset.list_assets') }}" class="quick-action-card">
                <div class="quick-action-icon assets">
                    <i class="bi bi-hdd-stack"></i>
                </div>
                <div class="quick-action-content">
                    <h3 class="quick-action-title">Gerenciar Assets</h3>
                    <p class="quick-action-description">Visualize e gerencie seus ativos de TI</p>
                </div>
                <div class="quick-action-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('monitoring.monitoring_home') }}" class="quick-action-card">
                <div class="quick-action-icon monitoring">
                    <i class="bi bi-activity"></i>
                </div>
                <div class="quick-action-content">
                    <h3 class="quick-action-title">Monitoramento</h3>
                    <p class="quick-action-description">Configure regras de monitoramento</p>
                </div>
                <div class="quick-action-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('main.analytics') }}" class="quick-action-card">
                <div class="quick-action-icon analytics">
                    <i class="bi bi-graph-up"></i>
                </div>
                <div class="quick-action-content">
                    <h3 class="quick-action-title">Analytics</h3>
                    <p class="quick-action-description">Análise de tendências e estatísticas</p>
                </div>
                <div class="quick-action-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('main.chatbot') }}" class="quick-action-card">
                <div class="quick-action-icon chatbot">
                    <i class="bi bi-chat-dots"></i>
                </div>
                <div class="quick-action-content">
                    <h3 class="quick-action-title">Assistente IA</h3>
                    <p class="quick-action-description">Obtenha ajuda com o chatbot inteligente</p>
                </div>
                <div class="quick-action-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
            </a>
        </div>
    </div>
            
    <!-- Vulnerabilidades Recentes -->
    <div class="recent-vulnerabilities-section">
        <div class="section-header">
            <h2 class="section-title">Vulnerabilidades Recentes</h2>
            <p class="section-subtitle">Últimas vulnerabilidades identificadas no sistema</p>
            <a href="{{ url_for('vulnerability_ui.list_vulnerabilities_ui') }}" class="section-action">
                Ver todas <i class="bi bi-arrow-right"></i>
            </a>
        </div>
        
        <div class="vulnerabilities-table-container">
            {% if vulnerabilities %}
                <div class="vulnerabilities-table">
                    <div class="table-header">
                        <div class="table-header-cell cve-id">CVE ID</div>
                        <div class="table-header-cell severity">Severidade</div>
                        <div class="table-header-cell description">Descrição</div>
                        <div class="table-header-cell date">Data de Publicação</div>
                        <div class="table-header-cell cvss">CVSS Score</div>
                        <div class="table-header-cell actions">Ações</div>
                    </div>
                    
                    {% for vuln in vulnerabilities %}
                    <div class="table-row">
                        <div class="table-cell cve-id">
                            {% if vuln.references and vuln.references|length > 0 %}
                                <a href="{{ vuln.references[0].url }}" target="_blank" class="cve-link">
                                    <span class="cve-badge">{{ vuln.cve_id }}</span>
                                </a>
                            {% else %}
                                <span class="cve-badge">{{ vuln.cve_id }}</span>
                            {% endif %}
                        </div>
                        <div class="table-cell severity">
                            <span class="severity-badge {{ vuln.base_severity | lower }}">
                                <i class="bi bi-{{ 'exclamation-triangle-fill' if vuln.base_severity == 'CRITICAL' else 'exclamation-circle-fill' if vuln.base_severity == 'HIGH' else 'info-circle-fill' }}"></i>
                                {{ vuln.base_severity }}
                            </span>
                        </div>
                        <div class="table-cell description">
                            <p class="vulnerability-description">{{ vuln.description | default('Sem descrição disponível') | truncate(120) }}</p>
                        </div>
                        <div class="table-cell date">
                            <span class="date-text">{{ vuln.published_date | datetimeformat('%d/%m/%Y') if vuln.published_date else 'N/A' }}</span>
                        </div>
                        <div class="table-cell cvss">
                            {% if vuln.cvss_score %}
                                <span class="cvss-score {{ 'critical' if vuln.cvss_score >= 9.0 else 'high' if vuln.cvss_score >= 7.0 else 'medium' if vuln.cvss_score >= 4.0 else 'low' }}">
                                    {{ "%.1f" | format(vuln.cvss_score) }}
                                </span>
                            {% else %}
                                <span class="cvss-score unknown">N/A</span>
                            {% endif %}
                        </div>
                        <div class="table-cell actions">
                            <a href="{{ url_for('main.vulnerability_details', cve_id=vuln.cve_id) }}" class="action-button view" title="Ver detalhes">
                                <i class="bi bi-eye"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                {% if page and total_pages and total_pages > 1 %}
                <div class="table-pagination">
                    <div class="pagination-info">
                        Página {{ page }} de {{ total_pages }}
                    </div>
                    <div class="pagination-controls">
                        {% if page > 1 %}
                            <a href="{{ url_for('main.index', page=page-1) }}" class="pagination-button prev">
                                <i class="bi bi-chevron-left"></i> Anterior
                            </a>
                        {% endif %}
                        {% if page < total_pages %}
                            <a href="{{ url_for('main.index', page=page+1) }}" class="pagination-button next">
                                Próxima <i class="bi bi-chevron-right"></i>
                            </a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <h3 class="empty-state-title">Nenhuma vulnerabilidade encontrada</h3>
                    <p class="empty-state-description">Não há vulnerabilidades registradas no momento. Isso é uma boa notícia!</p>
                    <a href="{{ url_for('vulnerability_ui.create_vulnerability_ui') }}" class="empty-state-action">
                        <i class="bi bi-plus-circle"></i> Adicionar vulnerabilidade
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}