{% macro severity_badge(severity) %}
  <span class="badge severity-badge severity-badge-{{ severity | default('N/A') | lower }}"
        aria-label="Severidade: {{ severity | default('N/A') | capitalize }}">
    {{ severity | default('N/A') | capitalize }}
  </span>
{% endmacro %}

{% macro render_pagination(pagination, endpoint, **kwargs) %}
  {% if pagination.pages > 1 %}
    <nav aria-label="Paginação" class="pagination-nav">
      <div class="pagination-info">
        <span class="pagination-text">
          Mostrando {{ pagination.per_page * (pagination.page - 1) + 1 }} a 
          {{ pagination.per_page * (pagination.page - 1) + pagination.items|length }} de 
          {{ pagination.total }} resultados
        </span>
      </div>
      
      <ul class="pagination pagination-sm justify-content-center mb-0">
        <!-- Previous Page -->
        <li class="page-item {{ 'disabled' if not pagination.has_prev else '' }}">
          {% if pagination.has_prev %}
            <a class="page-link" href="{{ url_for(endpoint, page=pagination.prev_num, **kwargs) }}" aria-label="Anterior">
              <i class="bi bi-chevron-left" aria-hidden="true"></i>
              <span class="sr-only">Anterior</span>
            </a>
          {% else %}
            <span class="page-link" aria-label="Anterior">
              <i class="bi bi-chevron-left" aria-hidden="true"></i>
              <span class="sr-only">Anterior</span>
            </span>
          {% endif %}
        </li>
        
        <!-- Page Numbers -->
        {% set start_page = [1, pagination.page - 2]|max %}
        {% set end_page = [pagination.pages, pagination.page + 2]|min %}
        
        <!-- First page if not in range -->
        {% if start_page > 1 %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for(endpoint, page=1, **kwargs) }}">1</a>
          </li>
          {% if start_page > 2 %}
            <li class="page-item disabled">
              <span class="page-link">...</span>
            </li>
          {% endif %}
        {% endif %}
        
        <!-- Page range -->
        {% for page_num in range(start_page, end_page + 1) %}
          <li class="page-item {{ 'active' if page_num == pagination.page else '' }}">
            {% if page_num == pagination.page %}
              <span class="page-link" aria-current="page">
                {{ page_num }}
                <span class="sr-only">(atual)</span>
              </span>
            {% else %}
              <a class="page-link" href="{{ url_for(endpoint, page=page_num, **kwargs) }}">{{ page_num }}</a>
            {% endif %}
          </li>
        {% endfor %}
        
        <!-- Last page if not in range -->
        {% if end_page < pagination.pages %}
          {% if end_page < pagination.pages - 1 %}
            <li class="page-item disabled">
              <span class="page-link">...</span>
            </li>
          {% endif %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for(endpoint, page=pagination.pages, **kwargs) }}">{{ pagination.pages }}</a>
          </li>
        {% endif %}
        
        <!-- Next Page -->
        <li class="page-item {{ 'disabled' if not pagination.has_next else '' }}">
          {% if pagination.has_next %}
            <a class="page-link" href="{{ url_for(endpoint, page=pagination.next_num, **kwargs) }}" aria-label="Próximo">
              <span class="sr-only">Próximo</span>
              <i class="bi bi-chevron-right" aria-hidden="true"></i>
            </a>
          {% else %}
            <span class="page-link" aria-label="Próximo">
              <span class="sr-only">Próximo</span>
              <i class="bi bi-chevron-right" aria-hidden="true"></i>
            </span>
          {% endif %}
        </li>
      </ul>
      
      <!-- Items per page selector -->
      <div class="pagination-controls">
        <div class="d-flex align-items-center gap-2">
          <label for="per-page-select" class="form-label mb-0 text-sm">Itens por página:</label>
          <select id="per-page-select" class="form-select form-select-sm" style="width: auto;" onchange="changePerPage(this.value)">
            <option value="10" {{ 'selected' if pagination.per_page == 10 }}>10</option>
            <option value="20" {{ 'selected' if pagination.per_page == 20 }}>20</option>
            <option value="50" {{ 'selected' if pagination.per_page == 50 }}>50</option>
            <option value="100" {{ 'selected' if pagination.per_page == 100 }}>100</option>
          </select>
        </div>
      </div>
    </nav>
    
    <script>
      function changePerPage(perPage) {
        const url = new URL(window.location);
        url.searchParams.set('per_page', perPage);
        url.searchParams.set('page', 1); // Reset to first page
        window.location.href = url.toString();
      }
    </script>
  {% endif %}
{% endmacro %}

{% macro action_button(icon, label, classes, tooltip, disabled=false, id='') %}
  <button type="button"
          class="btn btn-sm {{ classes }}"
          {% if id %}id="{{ id }}"{% endif %}
          data-bs-toggle="tooltip"
          title="{{ tooltip }}"
          aria-label="{{ label }}"
          {% if disabled %}disabled{% endif %}
          role="button"
          tabindex="0">
    <i class="bi bi-{{ icon }} me-1" aria-hidden="true"></i>{{ label }}
  </button>
{% endmacro %}

{% macro pagination(page, total_pages, current_args) %}
  {% if total_pages > 1 %}
    <nav aria-label="Paginação de vulnerabilidades">
      <ul class="pagination pagination-sm justify-content-center mb-0">
        <li class="page-item {{ 'disabled' if page <= 1 else '' }}">
          <a class="page-link" href="{{ url_for('main.index', page=page-1, **current_args) }}" aria-label="Anterior">
            <i class="bi bi-chevron-left" aria-hidden="true"></i>
          </a>
        </li>
        {% set max_pages = 5 %}
        {% set start = [1, page - max_pages // 2] | max %}
        {% set end = [start + max_pages - 1, total_pages] | min %}
        {% if start > 1 %}
          <li class="page-item"><a class="page-link" href="{{ url_for('main.index', page=1, **current_args) }}">1</a></li>
          {% if start > 2 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
          {% endif %}
        {% endif %}
        {% for p in range(start, end + 1) %}
          <li class="page-item {{ 'active' if p == page else '' }}">
            {% if p == page %}
              <span class="page-link">{{ p }}</span>
            {% else %}
              <a class="page-link" href="{{ url_for('main.index', page=p, **current_args) }}">{{ p }}</a>
            {% endif %}
          </li>
        {% endfor %}
        {% if end < total_pages %}
          {% if end < total_pages - 1 %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
          {% endif %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('main.index', page=total_pages, **current_args) }}">{{ total_pages }}</a>
          </li>
        {% endif %}
        <li class="page-item {{ 'disabled' if page >= total_pages else '' }}">
          <a class="page-link" href="{{ url_for('main.index', page=page+1, **current_args) }}" aria-label="Próximo">
            <i class="bi bi-chevron-right" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
    </nav>
  {% endif %}
{% endmacro %}