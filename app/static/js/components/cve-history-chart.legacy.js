(function() {
  // Legacy-safe logging
  function safeLog() {
    try { if (window.console && console.log) console.log.apply(console, arguments); } catch (e) {}
  }

  function onReady(fn) {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fn);
    } else {
      fn();
    }
  }

  function showLegacyMessage() {
    var chartCanvas = document.getElementById('cveHistoryChart');
    var loading = document.getElementById('chartLoading');

    if (loading) {
      loading.classList.add('d-none');
      loading.setAttribute('aria-hidden', 'true');
    }

    if (chartCanvas) {
      var container = chartCanvas.parentNode || document.querySelector('.card-body') || document.body;
      var msg = document.createElement('div');
      msg.className = 'alert alert-warning mt-2';
      msg.setAttribute('role', 'status');
      msg.setAttribute('aria-live', 'polite');
      msg.innerHTML = 'Gráfico indisponível no modo legacy. Atualize seu navegador para visualizar.';
      container.insertBefore(msg, chartCanvas.nextSibling);

      // Mark legacy mode for potential styling
      chartCanvas.setAttribute('data-legacy-mode', 'true');
    }
  }

  function CVEHistoryChartLegacy() {
    // No-op constructor for compatibility
  }

  onReady(function() {
    safeLog('[Legacy] CVE History Chart fallback initialized');
    showLegacyMessage();
  });

  // Expose a stub to avoid reference errors
  try { window.CVEHistoryChart = CVEHistoryChartLegacy; } catch (e) {}
})();