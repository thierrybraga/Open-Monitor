{% extends "core/base.html" %}

{% block title %}Chat - Open Monitor{% endblock %}

{% block extra_css %}
{# Removido: CSS de página já importado via main.css #}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Mobile Overlay -->
<div class="chat-overlay" id="chat-overlay"></div>

<div class="chat-container">
    <!-- Sidebar para conversas -->
    <div class="chat-sidebar">
        <div class="chat-sidebar-header">
            <div class="sidebar-title">
                <h3><i class="bi bi-chat-dots me-2"></i>Conversas</h3>
            </div>
            <div class="sidebar-actions">
                <button class="btn-new-chat" id="new-chat-btn" aria-label="Nova Conversa">
                    <i class="bi bi-plus-lg"></i>
                    Nova Conversa
                </button>
                <button class="btn-manage-sessions" onclick="chatManager.showBulkDeleteModal()" title="Gerenciar Conversas">
                    <i class="bi bi-gear"></i>
                </button>
            </div>
        </div>
        
        <div class="chat-sessions-container">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="bi bi-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Buscar conversas..." id="searchInput">
                </div>
            </div>
            
            <div class="chat-sessions-list" id="chatSessions">
                <!-- Lista de conversas será carregada aqui -->
            </div>
        </div>
    </div>

    <!-- Área principal do chat -->
    <div class="chat-main">
        <!-- Cabeçalho do chat -->
        <header class="chat-header">
            <button class="mobile-menu-toggle" id="mobile-menu-toggle" title="Menu">
                <i class="bi bi-list"></i>
            </button>
            <div class="chat-info">
                <h2 class="chat-title" id="current-chat-title">Open Monitor AI</h2>
            </div>
            
            <div class="chat-actions">
                <button class="btn btn-outline-secondary btn-sm" id="edit-title-btn" title="Editar título" aria-label="Editar título">
                    <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-outline-secondary btn-sm" id="export-chat-btn" title="Exportar conversa" aria-label="Exportar conversa">
                    <i class="bi bi-download"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" id="delete-chat-btn" title="Excluir conversa" aria-label="Excluir conversa">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </header>

        <!-- Área de mensagens -->
        <div class="chat-messages" id="chatMessages">
            <!-- Mensagem de boas-vindas -->
            <div class="welcome-message">
                <div class="welcome-icon">
                    <i class="bi bi-robot"></i>
                </div>
                <h3 class="welcome-title">Bem-vindo ao Open Monitor AI</h3>
                <p class="welcome-subtitle">Como posso ajudá-lo hoje? Você pode fazer perguntas sobre monitoramento, análise de dados ou qualquer outro tópico.</p>
                
                <!-- Botões de ação rápida -->
                <div class="quick-actions">
                    <button class="quick-action-btn" data-message="Como funciona o monitoramento?" aria-label="Enviar ação rápida: Como funciona?">
                        <i class="bi bi-question-circle"></i>
                        Como funciona?
                    </button>
                    <button class="quick-action-btn" data-message="Mostrar estatísticas do sistema" aria-label="Enviar ação rápida: Estatísticas">
                        <i class="bi bi-graph-up"></i>
                        Estatísticas
                    </button>
                    <button class="quick-action-btn" data-message="Configurar alertas" aria-label="Enviar ação rápida: Alertas">
                        <i class="bi bi-bell"></i>
                        Alertas
                    </button>
                    <button class="quick-action-btn" data-message="Ajuda com comandos" aria-label="Enviar ação rápida: Comandos">
                        <i class="bi bi-terminal"></i>
                        Comandos
                    </button>
                </div>
            </div>
        </div>

        <!-- Indicador de digitação -->
        <div class="typing-indicator" id="typingIndicator" style="display: none;">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            <span class="typing-text">Assistente está digitando...</span>
        </div>

        <!-- Área de input -->
        <div class="chat-input-area" id="chat-input-area">
            <form id="chatForm" class="chat-form">
                <div class="input-container">
                    <textarea 
                        id="messageInput" 
                        class="message-input" 
                        placeholder="Digite sua mensagem..." 
                        rows="1"
                        maxlength="2000"
                    ></textarea>
                    
                    <div class="input-actions">
                        <button type="button" class="input-btn btn-attachment" id="attachBtn" title="Anexar arquivo" aria-label="Anexar arquivo">
                            <i class="bi bi-paperclip"></i>
                        </button>
                        <button type="submit" class="input-btn send-btn" id="sendBtn" title="Enviar mensagem">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </div>
                
                <div class="char-counter" id="charCounter">
                    <span id="charCount">0</span>/2000
                </div>
                
                <div class="input-hint">
                    <i class="bi bi-info-circle"></i>
                    Pressione Enter para enviar, Shift+Enter para nova linha
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para editar título -->
<div class="modal fade" id="edit-title-modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar Título da Conversa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="edit-title-form">
                    <div class="mb-3">
                        <label for="new-title" class="form-label">Novo Título</label>
                        <input type="text" class="form-control" id="new-title" maxlength="255" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="save-title-btn">Salvar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para confirmar exclusão -->
<div class="modal fade" id="delete-chat-modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Exclusão</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir esta conversa? Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Excluir</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast para notificações -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="notification-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="fas fa-info-circle text-primary me-2"></i>
            <strong class="me-auto">Notificação</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toast-message">
            <!-- Mensagem será inserida aqui -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/pages/chat.js') }}" defer nonce="{{ nonce }}"></script>
{% endblock %}